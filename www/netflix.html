<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>reCAPTCHA Client</title>
    <script
        src="https://www.google.com/recaptcha/enterprise.js?render=6Lf8hrcUAAAAAIpQAFW2VFjtiYnThOjZOA5xvLyR"></script>
</head>

<body>
    <h1>reCAPTCHA WebSocket Demo</h1>

    <script>
        function connect_to_websocket() {
            // Connect to the WebSocket server
            const ws = new WebSocket("ws://localhost:3001");

            ws.onopen = () => {
                console.log("Connected to server");
            };

            ws.onmessage = async (event) => {
                const msg = JSON.parse(event.data);
                if (msg.action === "send") {
                    // Execute reCAPTCHA Enterprise
                    const token = await grecaptcha.enterprise.execute(
                        "6Lf8hrcUAAAAAIpQAFW2VFjtiYnThOjZOA5xvLyR",
                        { action: "trigger_send" }
                    );
                    // Send token back to the server
                    ws.send(JSON.stringify({ token }));
                }
            };
            ws.onerror = () => {}
            ws.onclose = () => {
                console.log("disconnected from server");
                console.log("reconnecting to server");
                connect_to_websocket()
            }
        }
        connect_to_websocket()

    </script>
</body>

</html>